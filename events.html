<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Sour+Gummy:wght@400;500;600;700&display=swap" rel="stylesheet">
  <title>InnoGrid — Events</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header class="nav">
    <div class="container nav-inner">
      <div class="logo"style="color: #6667ad;">INNOBUDGET</div>

      <nav class="nav-links" aria-label="Main navigation">
        <a href="index.html">Home</a>
        <a href="events.html">Events</a>
        <a href="wishlist.html">Wishlist</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="profile.html">Profile</a>
      </nav>

      <div class="roles">
        <a href="loginsignup.html" class="role-btn" id="auth-link">Login / Signup</a>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top:20px;">
    <section aria-labelledby="events-title">
      <div style="display:flex; align-items:baseline; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <h2 id="events-title" style="margin:0 0 8px; font-size:1.3rem;">Featured Events</h2>
        <div class="small">Showing hackathons, seminars & conferences — India only</div>
      </div>

      <div class="controls" role="region" aria-label="filters">
        <div class="control-item" style="display:flex; align-items:center; gap:8px;">
          <svg width="14" height="14" style="opacity:.6" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 21l-4.35-4.35"></path><circle cx="11" cy="11" r="6"></circle></svg>
          <input id="search" type="search" placeholder="Search events, e.g. hackathon" aria-label="Search events" />
        </div>

        <div class="control-item">
          <label class="small" for="city">City</label>
          <select id="city" aria-label="Filter by City">
            <option value="all">All India</option>
            <option>Mumbai</option>
            <option>Delhi</option>
            <option>Bengaluru</option>
            <option>Chennai</option>
            <option>Hyderabad</option>
            <option>Kolkata</option>
          </select>
        </div>

        <div class="control-item">
          <label class="small" for="type">Type</label>
          <select id="type" aria-label="Filter by Type">
            <option value="all">All</option>
            <option value="Hackathon">Hackathon</option>
            <option value="Seminar">Seminar</option>
            <option value="Conference">Conference</option>
          </select>
        </div>

        <div class="control-item">
          <label class="small" for="paid">Payment</label>
          <select id="paid" aria-label="Filter by Payment">
            <option value="all">All</option>
            <option value="free">Free</option>
            <option value="paid">Paid</option>
          </select>
        </div>

        <div class="control-item">
          <label class="small" for="sort">Sort</label>
          <select id="sort" aria-label="Sort events">
            <option value="date-asc">Date (Soonest)</option>
            <option value="price-asc">Price (Low → High)</option>
            <option value="price-desc">Price (High → Low)</option>
            <option value="name-asc">Name (A → Z)</option>
          </select>
        </div>

        <div style="margin-left:auto">
          <button id="reset" class="btn">Reset</button>
        </div>
      </div>

      <div id="eventsGrid" class="events-grid" aria-live="polite"></div>
    </section>
  </main>

  <footer class="container small" style="padding:24px 0;">
    © 2025 InnoGrid
  </footer>

  <div id="eventModal" class="modal-overlay">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h2 id="modalTitle"></h2>
      <p id="modalDescription"></p>
      <button id="registerBtn" class="btn">Register Now</button>
    </div>
  </div>

  <script>
    // Moved event data to a separate file for consistency
  </script>
  <script src="events_data.js"></script>
  <script>
    // DOM refs
    const grid = document.getElementById('eventsGrid');
    const searchEl = document.getElementById('search');
    const cityEl = document.getElementById('city');
    const typeEl = document.getElementById('type');
    const paidEl = document.getElementById('paid');
    const sortEl = document.getElementById('sort');
    const resetBtn = document.getElementById('reset');
    const eventModal = document.getElementById('eventModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalDescription = document.getElementById('modalDescription');
    const registerBtn = document.getElementById('registerBtn');
    const closeBtn = document.querySelector('.close-btn');

    // Wishlist logic (using localStorage for persistence)
    const wishlist = new Set(JSON.parse(localStorage.getItem('wishlist')) || []);

    function saveWishlist() {
        localStorage.setItem('wishlist', JSON.stringify([...wishlist]));
    }

    // utility: format date
    function formatDate(iso) {
      const d = new Date(iso);
      return d.toLocaleString('en-IN', {
        dateStyle: 'medium',
        timeStyle: 'short'
      });
    }

    // render
    function render(list) {
      grid.innerHTML = '';
      if (!list.length) {
        grid.innerHTML = '<div class="small" style="padding:18px;">No events match your filters.</div>';
        return;
      }
      for (const e of list) {
        const paidLabel = e.price === 0 ? 'Free' : '₹' + e.price.toLocaleString('en-IN');
        const isWished = wishlist.has(e.id);
        const onlineStatusBadge = `<span class="${e.isOnline ? 'online-badge' : 'offline-badge'}">${e.isOnline ? 'Online' : 'Offline'}</span>`;

        const card = document.createElement('article');
        card.className = 'event-card';
        card.setAttribute('data-id', e.id);
        card.innerHTML = `
          <div>
            <div class="meta">
              <div class="type-badge">${e.type}</div>
              <div class="price">${paidLabel}</div>
            </div>
            <div class="event-title">${e.title}</div>
            <div class="event-details">
              <div>${onlineStatusBadge}</div>
              <div>${formatDate(e.date)}</div>
              <div style="margin-top:6px">${e.city}</div>
            </div>
          </div>

          <div style="display:flex; justify-content:space-between; align-items:flex-end;">
              <div class="small" style="margin-top:12px">Category: ${e.type} • ${e.city}</div>
              <button class="wishlist-btn ${isWished ? 'active' : ''}" data-id="${e.id}" aria-label="Add to wishlist">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
              </button>
          </div>
        `;
        grid.appendChild(card);
      }

      // Attach event listeners after rendering
      document.querySelectorAll('.wishlist-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation(); // Prevents the card click event
          const id = parseInt(btn.dataset.id);
          if (wishlist.has(id)) {
            wishlist.delete(id);
          } else {
            wishlist.add(id);
          }
          btn.classList.toggle('active');
          saveWishlist();
        });
      });

      document.querySelectorAll('.event-card').forEach(card => {
        card.addEventListener('click', (e) => {
          if (!e.target.closest('.wishlist-btn')) { // Don't open modal if wishlist button is clicked
            const id = parseInt(card.dataset.id);
            const event = EVENTS.find(e => e.id === id);
            if (event) {
              modalTitle.innerText = event.title;
              modalDescription.innerText = event.description;
              // Updated to redirect to new registration page, including the price
              registerBtn.onclick = () => window.location.href = `register.html?id=${event.id}&price=${event.price}`;
              eventModal.style.display = 'flex';
            }
          }
        });
      });
    }

    // Filtering + sorting logic
    function applyFilters() {
      const q = searchEl.value.trim().toLowerCase();
      const city = cityEl.value;
      const type = typeEl.value;
      const paid = paidEl.value;
      const sort = sortEl.value;

      let filtered = EVENTS.filter(e => {
        if (city !== 'all' && e.city !== city) return false;
        if (type !== 'all' && e.type !== type) return false;
        if (paid === 'free' && e.price !== 0) return false;
        if (paid === 'paid' && e.price === 0) return false;
        if (q && !(e.title.toLowerCase().includes(q) || e.type.toLowerCase().includes(q) || e.city.toLowerCase().includes(q))) return false;
        return true;
      });

      // sort
      if (sort === 'date-asc') filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
      else if (sort === 'price-asc') filtered.sort((a, b) => a.price - b.price);
      else if (sort === 'price-desc') filtered.sort((a, b) => b.price - a.price);
      else if (sort === 'name-asc') filtered.sort((a, b) => a.title.localeCompare(b.title));

      render(filtered);
    }

    // init: check role param if present to preselect role (optional)
    function initFromQuery() {
      const params = new URLSearchParams(location.search);
      const role = params.get('role');
      if (role) {
        console.info('Role from query:', role);
      }
    }

    // events
    [searchEl, cityEl, typeEl, paidEl, sortEl].forEach(el => {
      el.addEventListener('input', applyFilters);
      el.addEventListener('change', applyFilters);
    });
    resetBtn.addEventListener('click', () => {
      searchEl.value = '';
      cityEl.value = 'all';
      typeEl.value = 'all';
      paidEl.value = 'all';
      sortEl.value = 'date-asc';
      applyFilters();
    });

    // role buttons navigate with role param
    document.querySelectorAll('.role-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const r = btn.dataset.role;
        location.href = 'events.html?role=' + encodeURIComponent(r);
      });
    });

    // Modal close event listener
    closeBtn.addEventListener('click', () => {
      eventModal.style.display = 'none';
    });
    eventModal.addEventListener('click', (e) => {
      if (e.target === eventModal) {
        eventModal.style.display = 'none';
      }
    });

    // initial render
    initFromQuery();
    sortEl.value = 'date-asc';
    applyFilters();

    // Check login status and update auth link
    const authLink = document.getElementById('auth-link');
    const loggedInUser = localStorage.getItem('loggedInUser');
    if (loggedInUser) {
      const username = loggedInUser.split('@')[0];
      authLink.innerText = username;
      authLink.href = 'profile.html';
    }
  </script>
</body>
</html>